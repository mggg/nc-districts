(this.webpackJsonpnc=this.webpackJsonpnc||[]).push([[0],[,,,,,,,,,,function(e,t,a){e.exports=a(18)},,,,,function(e,t,a){},function(e,t,a){e.exports=a.p+"static/media/logo.5d5d9eef.svg"},function(e,t,a){},function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),o=a(9),i=a.n(o),s=(a(15),a(16),a(17),a(1)),c=a(2),u=a(5),l=a(6),h=a(7),p=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(s.a)(this,a),(r=t.call(this)).state={selectItem:0},r.clickTest=r.clickTest.bind(Object(h.a)(r)),r}return Object(c.a)(a,[{key:"clickTest",value:function(e,t){e.preventDefault(),this.setState({selectItem:t}),this.props.switchLayer(t)}},{key:"render",value:function(){var e=this;return n.a.createElement("ul",{className:"nav nav-pills"},this.props.labels.map((function(t,a){return n.a.createElement("li",{className:"nav-item",key:a},n.a.createElement("a",{className:"nav-link "+(a===e.state.selectItem?"active":""),href:"#",onClick:function(t){e.clickTest(t,a)}},t.name))})))}}]),a}(n.a.Component);function d(e){var t={},a=[],r=e.selected,o="",i="",s=0;if(r.length){(a=Object.keys(r[0].properties).filter((function(e){return 0===e.indexOf("age_")})).sort((function(e,t){return e.split("_")[1].replace("lt","0")-t.split("_")[1].replace("lt","0")}))).forEach((function(e){return t[e]=0}));var c=0;r.forEach((function(e){a.forEach((function(a){return t[a]+=e.properties[a]})),c+=e.properties.TOTPOP}));var u=c/2;a.forEach((function(e,a){""===o&&(u-=t[e])<=0&&(o=a,i=e)}))}var l=a.map((function(e){var a=e.replace("lt_5","0_4").replace("85_plu","85_90").split("_"),r=2===a.length?1:a[2]-a[1]+1,n=t[e]/r;return s=Math.max(s,n),{width:6*r,height:n}}));return n.a.createElement("div",null,n.a.createElement("div",{className:"histogram"},l.map((function(e,t){var a=t===o;return n.a.createElement("div",{style:{background:a?"#888":"#444",width:e.width,height:e.height/s*100}})}))),n.a.createElement("small",null,"Youngest to Oldest"),n.a.createElement("br",null),i?n.a.createElement("span",null,"Median: ",i.replace("age_","").replace("_"," \u2013 ")):null)}function v(e){return console.log(e.selected),n.a.createElement("table",null,n.a.createElement("thead",null),n.a.createElement("tbody",null))}var m=a(3);var y=function(){function e(t,a,r){Object(s.a)(this,e),this.map=t,this.layer=a,this.id=a.id,this.sourceId=a.source,this.type=a.type,this.sourceLayer=a["source-layer"],r?r(t,a):t&&t.addLayer(a),this.getFeature=this.getFeature.bind(this)}return Object(c.a)(e,[{key:"addToMap",value:function(e){e&&!this.map&&(this.map=e,e.addLayer(this.layer))}},{key:"remove",value:function(){this.map&&(this.map.removeLayer(this.id),this.map=null)}},{key:"setOpacity",value:function(e,t){this.setPaintProperty("".concat(t?"text":this.type.replace("symbol","icon"),"-opacity"),e)}},{key:"setColor",value:function(e){this.setPaintProperty("".concat(this.type,"-color"),e)}},{key:"getColor",value:function(){return this.getPaintProperty("".concat(this.type,"-color"))}},{key:"setPaintProperties",value:function(e){for(var t in e)this.setPaintProperty(t,e[t])}},{key:"setFeatureState",value:function(e,t){this.map.setFeatureState({source:this.sourceId,sourceLayer:this.sourceLayer,id:e},t)}},{key:"setCountyState",value:function(e,t,a,r,n,o){var i=this,s=new Set,c=["all",["has",t]];["COUNTY","CTYNAME","CNTYNAME","COUNTYFP10","cnty_nm","locality"].includes(t)?c.push(["==",["get",t],e]):(c.push([">=",["get",t],e]),c.push(["<",["get",t],isNaN(1*e)||t.toLowerCase().includes("name")?e+"z":String(Number(e)+1)])),this.map.querySourceFeatures(this.sourceId,{sourceLayer:this.sourceLayer,filter:c}).forEach((function(e){s.has(e.id)||(s.add(e.id),e.state=i.getFeatureState(e.id),r(e)&&(n[e.id]={properties:e.properties,color:String(e.state.color)},o.forEach((function(t){t(e,a.color)})),i.setFeatureState(e.id,Object(m.a)({},e.state,{color:a.color})),e.state.color=a.color))}))}},{key:"setPaintProperty",value:function(e,t){this.map.setPaintProperty(this.id,e,t)}},{key:"getPaintProperty",value:function(e){return this.map.getPaintProperty(this.id,e)}},{key:"getFeatureState",value:function(e){return this.map.getFeatureState({source:this.sourceId,sourceLayer:this.sourceLayer,id:e})}},{key:"getFeature",value:function(e){return this.map.querySourceFeatures(this.sourceId,{sourceLayer:this.sourceLayer,filter:["==",["id"],e]})[0]}},{key:"queryRenderedFeatures",value:function(){return this.map.queryRenderedFeatures(null,{layers:[this.id]})}},{key:"querySourceFeatures",value:function(){return this.map.querySourceFeatures(this.sourceId,{sourceLayer:this.sourceLayer})}},{key:"getAssignment",value:function(e){return this.getFeatureState(e).color}},{key:"setAssignment",value:function(e,t){this.setFeatureState(e.id,Object(m.a)({},e.state,{color:t}))}},{key:"on",value:function(e){for(var t,a=arguments.length,r=new Array(a>1?a-1:0),n=1;n<a;n++)r[n-1]=arguments[n];(t=this.map).on.apply(t,[e,this.id].concat(r))}},{key:"off",value:function(e){for(var t,a=arguments.length,r=new Array(a>1?a-1:0),n=1;n<a;n++)r[n-1]=arguments[n];(t=this.map).off.apply(t,[e,this.id].concat(r))}},{key:"untilSourceLoaded",value:function(e){var t=this;if(this.map.isSourceLoaded(this.sourceId))return e();this.map.on("sourcedata",(function a(){return e((function(){return t.map.off("sourcedata",a)}))}))}}]),e}(),f=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e,r,n){var o;return Object(s.a)(this,a),(o=t.call(this,e)).radius=r,o.hoveredFeatures=[],o.setMapSelection=n,o}return Object(c.a)(a,[{key:"hoverOff",value:function(){var e=this;this.hoveredFeatures.forEach((function(t){var a=e.layer.getFeatureState(t.id);e.layer.setFeatureState(t.id,Object(m.a)({},a,{hover:!1}))})),this.hoveredFeatures=[],this.setMapSelection(this.hoveredFeatures)}},{key:"hoverOn",value:function(e){var t=this;this.hoveredFeatures=e,this.deactivatedHover||this.hoveredFeatures.forEach((function(e){t.layer.setFeatureState(e.id,Object(m.a)({},e.state,{hover:!0}))})),this.setMapSelection(this.hoveredFeatures)}},{key:"onMouseMove",value:function(e){var t=function(e,t){var a=[e.x+t,e.y+t];return[[e.x-t,e.y-t],a]}(e.point,this.radius),a=this.layer.map.queryRenderedFeatures(t,{layers:[this.layer.id]});a.length>0&&(this.hoverOff(),this.hoverOn(a))}}]),a}(function(){function e(t){Object(s.a)(this,e),this.layer=t,this.hoveredFeature=null,this.deactivatedHover=!1,this.onMouseMove=this.onMouseMove.bind(this),this.onMouseLeave=this.onMouseLeave.bind(this),this.hoverOff=this.hoverOff.bind(this)}return Object(c.a)(e,[{key:"hoverOff",value:function(){null!==this.hoveredFeature&&(this.layer.setFeatureState(this.hoveredFeature.id,Object(m.a)({},this.hoveredFeature.state,{hover:!1})),this.hoveredFeature=null)}},{key:"hoverOn",value:function(e){this.hoveredFeature=e,this.deactivatedHover||this.layer.setFeatureState(e.id,Object(m.a)({},e.state,{hover:!0}))}},{key:"onMouseMove",value:function(e){e.features.length>0&&(this.hoverOff(),this.hoverOn(e.features[0]))}},{key:"onMouseLeave",value:function(){this.hoverOff()}},{key:"activate",value:function(e){e?this.deactivatedHover=!1:(this.layer.on("mousemove",this.onMouseMove),this.layer.on("mouseleave",this.onMouseLeave),this.layer.on("touchmove",this.onMouseMove),this.layer.on("touchend",this.onMouseLeave))}},{key:"deactivate",value:function(e){e?this.deactivatedHover=!0:(this.layer.off("mousemove",this.onMouseMove),this.layer.off("mouseleave",this.onMouseLeave),this.layer.off("touchmove",this.onMouseMove),this.layer.off("touchend",this.onMouseLeave))}}]),e}());var b=a(4);function g(e){var t=["match",["feature-state","color"]].concat(Object(b.a)(e.map((function(e){return[e.id,e.color]})).reduce((function(e,t){return[].concat(Object(b.a)(e),Object(b.a)(t))}))),["rgba(0, 0, 0, 0)"]);return["case",["boolean",["feature-state","hover"],!1],["match",["feature-state","color"]].concat(Object(b.a)(e.map((function(e){return[e.id,e.hoverColor]})).reduce((function(e,t){return[].concat(Object(b.a)(e),Object(b.a)(t))}))),["#aaaaaa"]),t]}window.mapboxgl.accessToken="pk.eyJ1IjoiZGlzdHJpY3RyIiwiYSI6ImNqbjUzMTE5ZTBmcXgzcG81ZHBwMnFsOXYifQ.8HRRLKHEJA0AismGk2SX2g";var k=[{name:"Age",units:"blockgroups"},{name:"Elections",units:"precincts"},{name:"Environment",units:"points"},{name:"Food",units:"tracts"},{name:"Race",units:"precincts"},{name:"Landmarks",units:"points"}],L=[{id:0,color:"#0099cd"},{id:1,color:"#ffca5d"},{id:2,color:"#00cd99"}];L.forEach((function(e){e.hoverColor=function(e,t){(e=String(e).replace(/[^0-9a-f]/gi,"")).length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),t=t||0;var a,r,n="#";for(r=0;r<3;r++)a=parseInt(e.substr(2*r,2),16),n+=("00"+(a=Math.round(Math.min(Math.max(0,a+a*t),255)).toString(16))).substr(a.length);return n}(e.color,-.3)}));var O=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(s.a)(this,a),(r=t.call(this)).state={currentColorLayer:0,currentUnitLayer:"",unitLayers:{},mapSelection:[]},r}return Object(c.a)(a,[{key:"componentDidMount",value:function(){var e=this,t={nc:{center:[-80.1,35.2154083],zoom:5.5}};this.map=new window.mapboxgl.Map({container:this.refs.map,style:"mapbox://styles/mapbox/light-v10",center:t.nc.center,zoom:t.nc.zoom,attributionControl:!1,pitchWithRotate:!1,dragPan:!0,touchZoomRotate:!0}),this.map.on("load",(function(){var t=new window.MapboxGeocoder({accessToken:window.mapboxgl.accessToken,marker:{color:"orange"},mapboxgl:window.mapboxgl});e.map.addControl(t,"top-left"),e.map.addControl(new window.mapboxgl.NavigationControl),e.map.addSource("state_outline",{type:"vector",url:"mapbox://mapbox.hist-pres-election-state"}),e.map.addLayer({id:"state_outline",source:"state_outline","source-layer":"historical_pres_elections_state",type:"line",paint:{"line-color":"#555","line-width":["case",["==",["get","state_abbrev"],"NC"],1.5,0]}}),e.map.addSource("precincts",{type:"vector",url:"mapbox://districtr.nc_precincts"});var a=new y(null,{id:"precincts-borders",source:"precincts","source-layer":"nc_precincts",type:"line",paint:{"line-color":"#777777","line-width":["interpolate",["linear"],["zoom"],0,0,7,1],"line-opacity":.3}}),r=new y(null,{id:"precincts",source:"precincts","source-layer":"nc_precincts",type:"fill",paint:{"fill-color":g(L),"fill-opacity":.8}}),n=new f(r,20,e.setMapSelection.bind(e));e.map.addSource("blockgroups",{type:"vector",url:"mapbox://districtr.nc_bg_blockgroups"});var o=new y(e.map,{id:"blockgroups-borders",source:"blockgroups","source-layer":"nc_bg_blockgroups",type:"line",paint:{"line-color":"#777777","line-width":["interpolate",["linear"],["zoom"],0,0,7,1],"line-opacity":.3}}),i=new y(e.map,{id:"blockgroups",source:"blockgroups","source-layer":"nc_bg_blockgroups",type:"fill",paint:{"fill-color":g(L),"fill-opacity":.8}}),s=new f(i,20,e.setMapSelection.bind(e));s.activate(),e.setState({currentUnitLayer:"blockgroups",unitLayers:{blockgroups:i,blockgroups_border:o,blockgroups_cursor:s,precincts:r,precincts_border:a,precincts_cursor:n}})}))}},{key:"setMapSelection",value:function(e){this.setState({mapSelection:e})}},{key:"switchLayer",value:function(e){var t=k[e];"points"===t.units?(console.log("points"),this.setState({currentColorLayer:e})):t.units===this.state.currentUnitLayer?(console.log("same units"),this.setState({currentColorLayer:e})):(this.state.unitLayers[this.state.currentUnitLayer+"_cursor"].deactivate(),this.state.unitLayers[this.state.currentUnitLayer].remove(),this.state.unitLayers[this.state.currentUnitLayer+"_border"].remove(),this.state.unitLayers[t.units].addToMap(this.map),this.state.unitLayers[t.units+"_border"].addToMap(this.map),this.state.unitLayers[t.units+"_cursor"].activate(),this.setState({currentUnitLayer:t.units,currentColorLayer:e}))}},{key:"render",value:function(){var e=k[this.state.currentColorLayer].name;return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"map",ref:"map"}),n.a.createElement("div",{className:"legend"},n.a.createElement("div",{className:"options"},n.a.createElement(p,{labels:k,switchLayer:this.switchLayer.bind(this)})),n.a.createElement("div",{className:"outputs"},e,"- Units: ",this.state.currentUnitLayer,n.a.createElement("br",null),"Age"===e?n.a.createElement(d,{selected:this.state.mapSelection}):null,"Elections"===e?n.a.createElement(v,{selected:this.state.mapSelection}):null)))}}]),a}(n.a.Component);var E=function(){return n.a.createElement("div",{className:"App"},n.a.createElement("header",{className:"App-header"},n.a.createElement("h1",null,"Redistricting in North Carolina"),n.a.createElement("h3",null,"Demo Version")),n.a.createElement("section",null,n.a.createElement("p",null,"We have developed a demo app to map out statewide and local decisions in redistricting. Interactive layers make it possible to analyze district lines based on age, race, environmental health, past elections, and other factors."),n.a.createElement(O,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(E,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}],[[10,1,2]]]);
//# sourceMappingURL=main.108037bf.chunk.js.map