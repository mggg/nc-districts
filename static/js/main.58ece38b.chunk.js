(this.webpackJsonpnc=this.webpackJsonpnc||[]).push([[0],[,,,,,,,,,,function(e,t,a){e.exports=a(18)},,,,,function(e,t,a){},function(e,t,a){e.exports=a.p+"static/media/logo.5d5d9eef.svg"},function(e,t,a){},function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(9),i=a.n(o),s=(a(15),a(16),a(17),a(1)),c=a(2),l=a(5),u=a(6),h=a(7),p=function(e){Object(u.a)(a,e);var t=Object(l.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this)).state={selectItem:0},n.clickTest=n.clickTest.bind(Object(h.a)(n)),n}return Object(c.a)(a,[{key:"clickTest",value:function(e,t){e.preventDefault(),this.setState({selectItem:t}),this.props.switchLayer(t)}},{key:"render",value:function(){var e=this;return r.a.createElement("ul",{className:"nav nav-pills"},this.props.labels.map((function(t,a){return r.a.createElement("li",{className:"nav-item",key:a},r.a.createElement("a",{className:"nav-link "+(a===e.state.selectItem?"active":""),href:"#",onClick:function(t){e.clickTest(t,a)}},t.name))})))}}]),a}(r.a.Component);function d(e){var t={},a=[],n=e.selected,o="",i="",s=0;if(n.length){(a=Object.keys(n[0].properties).filter((function(e){return 0===e.indexOf("age_")})).sort((function(e,t){return e.split("_")[1].replace("lt","0")-t.split("_")[1].replace("lt","0")}))).forEach((function(e){return t[e]=0}));var c=0;n.forEach((function(e){a.forEach((function(a){return t[a]+=e.properties[a]})),c+=e.properties.TOTPOP}));var l=c/2;a.forEach((function(e,a){""===o&&(l-=t[e])<=0&&(o=a,i=e)}))}var u=a.map((function(e){var a=e.replace("lt_5","0_4").replace("85_plu","85_90").split("_"),n=2===a.length?1:a[2]-a[1]+1,r=t[e]/n;return s=Math.max(s,r),{width:6*n,height:r}}));return r.a.createElement("div",null,r.a.createElement("div",{className:"histogram"},u.map((function(e,t){var a=t===o;return r.a.createElement("div",{key:t,style:{background:a?"#888":"#444",width:e.width,height:e.height/s*100}})}))),r.a.createElement("small",null,"Youngest to Oldest"),r.a.createElement("br",null),i?r.a.createElement("span",null,"Median: ",i.replace("age_","").replace("_"," \u2013 ")):null)}function m(e){var t=e.selected,a={};if(t.length){var n=Object.keys(t[0].properties).filter((function(e){return 0===e.indexOf("EL")}));n.forEach((function(e){return a[e]=0})),t.forEach((function(e){n.forEach((function(t){return a[t]+=e.properties[t]}))}))}return r.a.createElement("div",null,r.a.createElement("span",null,"Two-party vote share"),r.a.createElement("table",{className:"table"},r.a.createElement("thead",null,r.a.createElement("th",null,"Year"),r.a.createElement("th",null,"Position"),r.a.createElement("th",null,"Democratic"),r.a.createElement("th",null,"Republican")),r.a.createElement("tbody",null,[[2008,"Governor","EL08G_GV_D","EL08G_GV_R"],[2008,"US Senate","EL08G_USS_","EL08G_US_1"],[2010,"US Senate","EL10G_USS_","EL10G_US_1"],[2012,"Governor","EL12G_GV_D","EL12G_GV_R"],[2012,"President","EL12G_PR_D","EL12G_PR_R"],[2014,"US Senate","EL14G_USS_","EL14G_US_1"],[2016,"Governor","EL16G_GV_D","EL16G_GV_R"],[2016,"President","EL16G_PR_D","EL16G_PR_R"],[2016,"US Senate","EL16G_USS_","EL16G_US_1"]].map((function(e,t){return r.a.createElement("tr",{key:t},r.a.createElement("td",null,e[0]),r.a.createElement("td",null,e[1]),r.a.createElement("td",{className:"digits"},(a[e[2]]||0).toLocaleString()),r.a.createElement("td",{className:"digits"},(a[e[3]]||0).toLocaleString()))})))))}var v=function(e){return r.a.createElement("span",{style:{background:e}})};function y(e){e.selected;return r.a.createElement("div",null,r.a.createElement("span",null,"Source: North Carolina Department of Environmental Quality"),r.a.createElement("br",null),r.a.createElement("span",null,"Environmental Map Key"),r.a.createElement("br",null),r.a.createElement("ul",{className:"colorList"},r.a.createElement("li",null,v("purple")," Title V"),r.a.createElement("li",null,v("green")," Synthetic Minor"),r.a.createElement("li",null,v("red")," Small"),r.a.createElement("li",null,v("blue")," Permit Exempt"),r.a.createElement("li",null,v("orange")," Registered"),r.a.createElement("li",null,v("yellow")," Permit/Registration Pending")))}function f(e){e.selected;return r.a.createElement("div",null,r.a.createElement("span",null,"Source: Homeland Infrastructure Foundation"))}function g(e){e.selected;return r.a.createElement("div",null,r.a.createElement("span",null,"Source: Homeland Infrastructure Foundation"))}var E=a(3);var b=function(){function e(t,a,n){Object(s.a)(this,e),this.map=t,this.layer=a,this.id=a.id,this.sourceId=a.source,this.type=a.type,this.sourceLayer=a["source-layer"],n?n(t,a):t&&t.addLayer(a),this.getFeature=this.getFeature.bind(this)}return Object(c.a)(e,[{key:"addToMap",value:function(e){e&&!this.map&&(this.map=e,e.addLayer(this.layer))}},{key:"remove",value:function(){this.map&&(this.map.removeLayer(this.id),this.map=null)}},{key:"setOpacity",value:function(e,t){this.setPaintProperty("".concat(t?"text":this.type.replace("symbol","icon"),"-opacity"),e)}},{key:"setColor",value:function(e){this.setPaintProperty("".concat(this.type,"-color"),e)}},{key:"getColor",value:function(){return this.getPaintProperty("".concat(this.type,"-color"))}},{key:"setPaintProperties",value:function(e){for(var t in e)this.setPaintProperty(t,e[t])}},{key:"setFeatureState",value:function(e,t){this.map.setFeatureState({source:this.sourceId,sourceLayer:this.sourceLayer,id:e},t)}},{key:"setCountyState",value:function(e,t,a,n,r,o){var i=this,s=new Set,c=["all",["has",t]];["COUNTY","CTYNAME","CNTYNAME","COUNTYFP10","cnty_nm","locality"].includes(t)?c.push(["==",["get",t],e]):(c.push([">=",["get",t],e]),c.push(["<",["get",t],isNaN(1*e)||t.toLowerCase().includes("name")?e+"z":String(Number(e)+1)])),this.map.querySourceFeatures(this.sourceId,{sourceLayer:this.sourceLayer,filter:c}).forEach((function(e){s.has(e.id)||(s.add(e.id),e.state=i.getFeatureState(e.id),n(e)&&(r[e.id]={properties:e.properties,color:String(e.state.color)},o.forEach((function(t){t(e,a.color)})),i.setFeatureState(e.id,Object(E.a)({},e.state,{color:a.color})),e.state.color=a.color))}))}},{key:"setPaintProperty",value:function(e,t){this.map.setPaintProperty(this.id,e,t)}},{key:"getPaintProperty",value:function(e){return this.map.getPaintProperty(this.id,e)}},{key:"getFeatureState",value:function(e){return this.map.getFeatureState({source:this.sourceId,sourceLayer:this.sourceLayer,id:e})}},{key:"getFeature",value:function(e){return this.map.querySourceFeatures(this.sourceId,{sourceLayer:this.sourceLayer,filter:["==",["id"],e]})[0]}},{key:"queryRenderedFeatures",value:function(){return this.map.queryRenderedFeatures(null,{layers:[this.id]})}},{key:"querySourceFeatures",value:function(){return this.map.querySourceFeatures(this.sourceId,{sourceLayer:this.sourceLayer})}},{key:"getAssignment",value:function(e){return this.getFeatureState(e).color}},{key:"setAssignment",value:function(e,t){this.setFeatureState(e.id,Object(E.a)({},e.state,{color:t}))}},{key:"on",value:function(e){for(var t,a=arguments.length,n=new Array(a>1?a-1:0),r=1;r<a;r++)n[r-1]=arguments[r];(t=this.map).on.apply(t,[e,this.id].concat(n))}},{key:"off",value:function(e){for(var t,a=arguments.length,n=new Array(a>1?a-1:0),r=1;r<a;r++)n[r-1]=arguments[r];(t=this.map).off.apply(t,[e,this.id].concat(n))}},{key:"untilSourceLoaded",value:function(e){var t=this;if(this.map.isSourceLoaded(this.sourceId))return e();this.map.on("sourcedata",(function a(){return e((function(){return t.map.off("sourcedata",a)}))}))}}]),e}(),S=function(e){Object(u.a)(a,e);var t=Object(l.a)(a);function a(e,n,r){var o;return Object(s.a)(this,a),(o=t.call(this,e)).radius=n,o.hoveredFeatures=[],o.setMapSelection=r,o}return Object(c.a)(a,[{key:"hoverOff",value:function(){var e=this;this.hoveredFeatures.forEach((function(t){var a=e.layer.getFeatureState(t.id);e.layer.setFeatureState(t.id,Object(E.a)({},a,{hover:!1}))})),this.hoveredFeatures=[],this.setMapSelection(this.hoveredFeatures)}},{key:"hoverOn",value:function(e){var t=this;this.hoveredFeatures=e,this.deactivatedHover||this.hoveredFeatures.forEach((function(e){t.layer.setFeatureState(e.id,Object(E.a)({},e.state,{hover:!0}))})),this.setMapSelection(this.hoveredFeatures)}},{key:"onMouseMove",value:function(e){var t=function(e,t){var a=[e.x+t,e.y+t];return[[e.x-t,e.y-t],a]}(e.point,this.radius),a=this.layer.map.queryRenderedFeatures(t,{layers:[this.layer.id]});a.length>0&&(this.hoverOff(),this.hoverOn(a))}}]),a}(function(){function e(t){Object(s.a)(this,e),this.layer=t,this.hoveredFeature=null,this.deactivatedHover=!1,this.onMouseMove=this.onMouseMove.bind(this),this.onMouseLeave=this.onMouseLeave.bind(this),this.hoverOff=this.hoverOff.bind(this)}return Object(c.a)(e,[{key:"hoverOff",value:function(){null!==this.hoveredFeature&&(this.layer.setFeatureState(this.hoveredFeature.id,Object(E.a)({},this.hoveredFeature.state,{hover:!1})),this.hoveredFeature=null)}},{key:"hoverOn",value:function(e){this.hoveredFeature=e,this.deactivatedHover||this.layer.setFeatureState(e.id,Object(E.a)({},e.state,{hover:!0}))}},{key:"onMouseMove",value:function(e){e.features.length>0&&(this.hoverOff(),this.hoverOn(e.features[0]))}},{key:"onMouseLeave",value:function(){this.hoverOff()}},{key:"activate",value:function(e){e?this.deactivatedHover=!1:(this.layer.on("mousemove",this.onMouseMove),this.layer.on("mouseleave",this.onMouseLeave),this.layer.on("touchmove",this.onMouseMove),this.layer.on("touchend",this.onMouseLeave))}},{key:"deactivate",value:function(e){e?this.deactivatedHover=!0:(this.layer.off("mousemove",this.onMouseMove),this.layer.off("mouseleave",this.onMouseLeave),this.layer.off("touchmove",this.onMouseMove),this.layer.off("touchend",this.onMouseLeave))}}]),e}());var L=a(4);function _(e){var t=["match",["feature-state","color"]].concat(Object(L.a)(e.map((function(e){return[e.id,e.color]})).reduce((function(e,t){return[].concat(Object(L.a)(e),Object(L.a)(t))}))),["rgba(0, 0, 0, 0)"]);return["case",["boolean",["feature-state","hover"],!1],["match",["feature-state","color"]].concat(Object(L.a)(e.map((function(e){return[e.id,e.hoverColor]})).reduce((function(e,t){return[].concat(Object(L.a)(e),Object(L.a)(t))}))),["#aaaaaa"]),t]}window.mapboxgl.accessToken="pk.eyJ1IjoiZGlzdHJpY3RyIiwiYSI6ImNqbjUzMTE5ZTBmcXgzcG81ZHBwMnFsOXYifQ.8HRRLKHEJA0AismGk2SX2g";var k=[{name:"Age",units:"blockgroups"},{name:"Elections",units:"precincts"},{name:"Environment",units:"points"},{name:"Food",units:"tracts"},{name:"Race",units:"precincts"},{name:"Colleges",units:"points"},{name:"Hospitals",units:"points"}],w=[{id:0,color:"#0099cd"},{id:1,color:"#ffca5d"},{id:2,color:"#00cd99"}];w.forEach((function(e){e.hoverColor=function(e,t){(e=String(e).replace(/[^0-9a-f]/gi,"")).length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),t=t||0;var a,n,r="#";for(n=0;n<3;n++)a=parseInt(e.substr(2*n,2),16),r+=("00"+(a=Math.round(Math.min(Math.max(0,a+a*t),255)).toString(16))).substr(a.length);return r}(e.color,-.3)}));var O=function(e){Object(u.a)(a,e);var t=Object(l.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this)).state={currentColorLayer:0,currentUnitLayer:"",unitLayers:{},pointLayers:{},mapSelection:[]},n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){var e=this,t={nc:{center:[-80.1,35.2154083],zoom:5.5}};this.map=new window.mapboxgl.Map({container:this.refs.map,style:"mapbox://styles/mapbox/light-v10",center:t.nc.center,zoom:t.nc.zoom,attributionControl:!1,pitchWithRotate:!1,dragPan:!0,touchZoomRotate:!0}),this.map.on("load",(function(){var t=new window.MapboxGeocoder({accessToken:window.mapboxgl.accessToken,marker:{color:"orange"},mapboxgl:window.mapboxgl});e.map.addControl(t,"top-left"),e.map.addControl(new window.mapboxgl.NavigationControl),e.map.addSource("state_outline",{type:"vector",url:"mapbox://mapbox.hist-pres-election-state"}),e.map.addLayer({id:"state_outline",source:"state_outline","source-layer":"historical_pres_elections_state",type:"line",paint:{"line-color":"#555","line-width":["case",["==",["get","state_abbrev"],"NC"],1.5,0]}}),e.map.addSource("precincts",{type:"vector",url:"mapbox://districtr.nc_precincts"});var a=new b(null,{id:"precincts-borders",source:"precincts","source-layer":"nc_precincts",type:"line",paint:{"line-color":"#777777","line-width":["interpolate",["linear"],["zoom"],0,0,7,1],"line-opacity":.3}}),n=new b(null,{id:"precincts",source:"precincts","source-layer":"nc_precincts",type:"fill",paint:{"fill-color":_(w),"fill-opacity":.8}}),r=new S(n,20,e.setMapSelection.bind(e));e.map.addSource("blockgroups",{type:"vector",url:"mapbox://districtr.nc_bg_blockgroups"});var o=new b(e.map,{id:"blockgroups-borders",source:"blockgroups","source-layer":"nc_bg_blockgroups",type:"line",paint:{"line-color":"#777777","line-width":["interpolate",["linear"],["zoom"],0,0,7,1],"line-opacity":.3}}),i=new b(e.map,{id:"blockgroups",source:"blockgroups","source-layer":"nc_bg_blockgroups",type:"fill",paint:{"fill-color":_(w),"fill-opacity":.8}}),s=new S(i,20,e.setMapSelection.bind(e));s.activate(),fetch("./nc-geo/nc_industry.geojson").then((function(e){return e.json()})).then((function(t){e.map.addSource("enviro",{type:"geojson",data:t}),e.state.pointLayers.Environment=new b(null,{id:"enviro",source:"enviro",type:"circle",paint:{"circle-radius":4,"circle-color":["match",["get","CLASS_STATUS"],"Title V","purple","Synthetic Minor","green","Small","red","Permit Exempt","blue","Registered","orange","Permit/Registration Pending","yellow","#ccc"]}})})),fetch("./nc-geo/nc_colleges.geojson").then((function(e){return e.json()})).then((function(t){e.map.addSource("colleges",{type:"geojson",data:t}),e.state.pointLayers.Colleges=new b(null,{id:"colleges",source:"colleges",type:"circle",paint:{"circle-radius":4,"circle-color":"blue"}})})),fetch("./nc-geo/nc_hospitals.geojson").then((function(e){return e.json()})).then((function(t){e.map.addSource("hospitals",{type:"geojson",data:t}),e.state.pointLayers.Hospitals=new b(null,{id:"hospitals",source:"hospitals",type:"circle",paint:{"circle-radius":4,"circle-color":"red"}})})),e.setState({currentUnitLayer:"blockgroups",unitLayers:{blockgroups:i,blockgroups_border:o,blockgroups_cursor:s,precincts:n,precincts_border:a,precincts_cursor:r}})}))}},{key:"setMapSelection",value:function(e){this.setState({mapSelection:e})}},{key:"switchLayer",value:function(e){var t=k[e];"points"===t.units?("points"===k[this.state.currentColorLayer].units&&this.state.pointLayers[k[this.state.currentColorLayer].name].remove(),this.state.pointLayers[t.name].addToMap(this.map),this.setState({currentColorLayer:e})):t.units===this.state.currentUnitLayer?(console.log("same units"),this.setState({currentColorLayer:e})):(this.state.unitLayers[this.state.currentUnitLayer+"_cursor"].deactivate(),this.state.unitLayers[this.state.currentUnitLayer].remove(),this.state.unitLayers[this.state.currentUnitLayer+"_border"].remove(),this.state.unitLayers[t.units].addToMap(this.map),this.state.unitLayers[t.units+"_border"].addToMap(this.map),this.state.unitLayers[t.units+"_cursor"].activate(),this.setState({currentUnitLayer:t.units,currentColorLayer:e}))}},{key:"render",value:function(){var e=k[this.state.currentColorLayer].name;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"map",ref:"map"}),r.a.createElement("div",{className:"legend"},r.a.createElement("div",{className:"options"},r.a.createElement(p,{labels:k,switchLayer:this.switchLayer.bind(this)})),r.a.createElement("div",{className:"outputs"},e,"- Units: ",this.state.currentUnitLayer,r.a.createElement("br",null),"Age"===e?r.a.createElement(d,{selected:this.state.mapSelection}):null,"Elections"===e?r.a.createElement(m,{selected:this.state.mapSelection}):null,"Environment"===e?r.a.createElement(y,{selected:this.state.mapSelection}):null,"Hospitals"===e?r.a.createElement(f,{selected:this.state.mapSelection}):null,"Colleges"===e?r.a.createElement(g,{selected:this.state.mapSelection}):null)))}}]),a}(r.a.Component);var M=function(){return r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"App-header"},r.a.createElement("h1",null,"Redistricting in North Carolina"),r.a.createElement("h3",null,"Demo Version")),r.a.createElement("section",null,r.a.createElement("p",null,"We have developed a demo app to map out statewide and local decisions in redistricting. Interactive layers make it possible to analyze district lines based on age, race, environmental health, past elections, and other factors."),r.a.createElement(O,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(M,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}],[[10,1,2]]]);
//# sourceMappingURL=main.58ece38b.chunk.js.map